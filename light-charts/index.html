<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>柱状图</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/reset.css">
</head>

<body>

    <div class="hello">
        <div class="chart-title">
            <div>
                <h3><span id="charTitle" class="charTitle chart-title"></span><span class="chart-title">税收占国民生产总值GDP</span></h3>
            </div>
        </div>
        <div class="box-data-chart">
            <div id="data-chart" class="bar-chart"></div>
        </div>
        <div class="country-select">
            <ul class="select-opion" id="list">
                <li id="china" class="select-option">中国</li>
                <li id="els" class="select-option">日本</li>
                <li id="eng" class="select-option">英国</li>
                <li id="french" class="select-option">法国</li>
                <li id="american" class="select-option">美国</li>
            </ul>
        </div>
    </div>
    <!-- <script src='js/echarts.min.js'></script> -->
    <!-- <script src='js/jquery-3.2.1.min.js'></script> -->
    <script src="https://cdn.bootcss.com/echarts/4.3.0-rc.2/echarts-en.common.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var arrCounrtyData = []
        var country = ''
        var key = '中国'
        var lineTableData = []; // 数据处理成表格
        let oneOfLineToFixed0 = []; //柱子上取整
        let oneOfLine0 = []; //
        window.onload = function() {
            switchData('中国')
        }
        $(document).ready(function(key) {
            var ul = document.getElementById("list");
            var ul_child = ul.getElementsByTagName('li');

            for (var i = 0; i < ul_child.length; i++) {
                ul_child[i].index = i;
                ul_child[i].onclick = function() {
                    var j = this.index;
                    key = $(".select-option")[j].innerText;
                    $(".charTitle")[0].innerText = key;
                    switchData(key)

                }
            }
            country = key

        });

        function switchData(key) {
            switch (key) {
                case "中国":
                    arrCounrtyData = [9.771406923, 10.10142693, 10.30944303, 10.21204751, 10.31279448, 9.907733077, 9.713067852, 9.416086828, 9.20099957]

                    getChart()
                    break;
                case "日本":
                    arrCounrtyData = [10.10618629, 8.931591654, 8.36891038, 8.809784435, 9.356818207, 9.682412944, 10.36061765, 11.46920658, 11.42357202, 11.15496587, 11.64194651]

                    getChart()
                    break;
                case "英国":
                    arrCounrtyData = [25.83340794, 26.42037326, 24.1084352, 25.37144103, 25.8601462, 25.11866914, 25.11299591, 24.83523514, 25.09121291, 25.47717113, 25.71953266]

                    getChart()
                    break;
                case "法国":
                    arrCounrtyData = [22.26269213, 22.14848573, 20.83089327, 22.08943166, 21.95942516, 22.68250157, 23.36867422, 23.31789754, 23.36046782, 23.20483732, 23.80610031]

                    getChart()
                    break;
                case "美国":
                    arrCounrtyData = [11.30719612, 10.31615636, 7.919615919, 8.595887591, 9.573699439, 9.79687152, 10.51960599, 10.95153383, 11.2046032, 10.98294396, 11.94741055]

                    getChart()
                    break;

            }
        }

        function getChart() {
            let yjsNums3 = arrCounrtyData.map(function(ele) {
                let obj = {
                    '2007': Number(ele['2007']).toFixed(3),
                    '2008': Number(ele['2008']).toFixed(3),
                    '2009': Number(ele['2009']).toFixed(3),
                    '2010': Number(ele['2010']).toFixed(3),
                    '2011': Number(ele['2011']).toFixed(3),
                    '2012': Number(ele['2012']).toFixed(3),
                    '2013': Number(ele['2013']).toFixed(3),
                    '2014': Number(ele['2014']).toFixed(3),
                    '2015': Number(ele['2015']).toFixed(3),
                    '2016': Number(ele['2016']).toFixed(3),
                    '2017': Number(ele['2017']).toFixed(3),
                    '2018': Number(ele['2018']).toFixed(3),
                }
                return obj
            })
            console.log('yjsNums3')
            console.log(yjsNums3)
            let itemValue0 = yjsNums3;

            for (var i in itemValue0) {
                oneOfLine0.push(itemValue0[i]);
                let objline = {};
                objline.year = i;
                objline.value = itemValue0[i];
                lineTableData.push(objline);
            }
            console.log('第二次加载，将第一次加载数组中的元素清空')
            console.log(arrCounrtyData)
                // 为了显示不重叠，去掉小数点后位数
            arrCounrtyData.forEach(element => {
                oneOfLineToFixed0.push(Number(element).toFixed(0));
            });
            console.log('第二次加载，将第一次加载柱状图中的元素清空')
            console.log(oneOfLineToFixed0)
            var dataChart = echarts.init(document.getElementById("data-chart"));
            let option = {
                title: {
                    text: "",
                    textStyle: {
                        color: "#fff",
                        padding: "3em"
                    }
                },
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: [{
                        name: " ",
                        icon: "circle",
                        textStyle: {
                            color: "#fff" // 图例文字颜色
                        }
                    }]
                },
                xAxis: {
                    type: "category",
                    name: "年",
                    boundaryGap: false,
                    data: [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018],
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                                // width:8,//这里是为了突出显示加上的
                        }
                    },
                    axisLabel: {
                        interval: 0, //横轴信息全部显示
                        rotate: -45, //度角倾斜显示
                        // formatter: function(value) {
                        //     //只显示五个字 其余省略号
                        //     return value.length > 5 ? value.substring(0, 5) + "..." : value;
                        // }
                    }
                },
                yAxis: {
                    show: true,
                    type: "value",
                    name: "占比",
                    axisLabel: {
                        formatter: "{value}%"
                    },
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                                // width:8,//这里是为了突出显示加上的
                        }
                    }
                },
                grid: {
                    left: "1%",
                    top: 40,
                    bottom: 10,
                    right: "8%",
                    // height:60,
                    containLabel: true
                },
                series: [{
                    name: country,
                    type: "bar",
                    stack: "总量",
                    // 显示数值
                    itemStyle: {
                        normal: {
                            label: {
                                show: true
                            }
                        }
                    },
                    barWidth: '20',
                    data: oneOfLineToFixed0,
                    color: "orange"
                        // leaves: {
                        //     label: {
                        //       normal: {
                        //         rotate: -65,
                        //       }
                        //     }
                        //   },
                }]
            };
            dataChart.setOption(option);
            oneOfLineToFixed0 = []

        }

        // function getRequest() {
        //     let url = window.location.search; //获取url中"?"符后的字串
        //     if (url.indexOf("=") != -1 && url.indexOf("&") != -1) {
        //         let leftIndex = url.indexOf("=") + 1;
        //         let rightIndex = url.indexOf("&");
        //         let str = url.slice(leftIndex, rightIndex); //提取=后&前的内容
        //         this.optionChange(decodeURI(str));
        //     } else {
        //         // let leftIndex = ;
        //         let str = url.slice(url.indexOf("=") + 1); //提取=后的内容，比如主键
        //         this.optionChange(decodeURI(str));
        //     }
        // }
    </script>
</body>

</html>