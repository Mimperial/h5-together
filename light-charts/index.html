<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/reset.css">
</head>

<body>

    <div class="hello">
        <div class="chart-title">
            <div>
                <h3><span id="charTitle" class="charTitle chart-title"></span><span class="chart-title">商品出口（现价美元）</span></h3>
            </div>
        </div>
        <div class="box-data-chart">
            <div id="data-chart" class="bar-chart"></div>
        </div>
        <div class="country-select">
            <ul class="select-opion" id="list">
                <li id="china" class="select-option">中国</li>
                <li id="els" class="select-option">俄罗斯</li>
                <li id="eng" class="select-option">英国</li>
                <li id="french" class="select-option">法国</li>
                <li id="american" class="select-option">美国</li>
            </ul>
        </div>
        <div class="table">
            <div style="display:flex;flex-direction:row;justify-content:center">
                <div class="data-part1" style>
                    <p>
                        <span class="table-year">2007年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2008年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2009年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2010年</span>
                        <span class="table-value"></span>
                    </p>
                </div>
                <div class="data-part1">
                    <p>
                        <span class="table-year">2011年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2012年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2013年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2014年</span>
                        <span class="table-value"></span>
                    </p>
                </div>
                <div class="data-part1">
                    <p>
                        <span class="table-year">2015年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2016年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2017年</span>
                        <span class="table-value"></span>
                    </p>
                    <p>
                        <span class="table-year">2018年</span>
                        <span class="table-value"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- <script src='js/echarts.min.js'></script> -->
    <!-- <script src='js/jquery-3.2.1.min.js'></script> -->
    <script src="https://cdn.bootcss.com/echarts/4.3.0-rc.2/echarts-en.common.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <!-- <script src="https://cdn.bootcss.com/bootstrap-table/1.15.4/bootstrap-table-locale-all.min.js"></script> -->
    <script>
        var arrCounrtyData = []
        var country = ''
        var key = '中国'
        var lineTableData = []; // 数据处理成表格
        let oneOfLineToFixed0 = []; //柱子上取整
        let oneOfLine0 = []; //
        window.onload = function() {
            switchData('中国')
        }
        $(document).ready(function(key) {
            var ul = document.getElementById("list");
            var ul_child = ul.getElementsByTagName('li');

            for (var i = 0; i < ul_child.length; i++) {
                ul_child[i].index = i;
                ul_child[i].onclick = function() {
                    var j = this.index;
                    key = $(".select-option")[j].innerText;
                    $(".charTitle")[0].innerText = key;
                    switchData(key)
                }
            }
            country = key

        });

        function switchData(key) {
            switch (key) {
                case "中国":
                    arrCounrtyData = [1220000000000.00, 1430000000000.00, 1200000000000.00, 1580000000000.00, 1900000000000.00, 2050000000000.00, 2210000000000.00, 2340000000000.00, 2270000000000.00, 2100000000000.00, 2260000000000.00, 2490000000000.00]
                    getChart()
                    break;
                case "俄罗斯":
                    arrCounrtyData = [354000000000.00, 472000000000.00, 303000000000.00, 401000000000.00, 522000000000.00, 529000000000.00, 522000000000.00, 497000000000.00, 341000000000.00, 282000000000.00, 354000000000.00, 444000000000.00]
                    getChart()
                    break;
                case "英国":
                    arrCounrtyData = [442000000000.00, 472000000000.00, 355000000000.00, 416000000000.00, 507000000000.00, 473000000000.00, 541000000000.00, 505000000000.00, 460000000000.00, 409000000000.00, 441000000000.00, 486000000000.00]
                    getChart()
                    break;
                case "法国":
                    arrCounrtyData = [560000000000.00, 616000000000.00, 485000000000.00, 524000000000.00, 596000000000.00, 569000000000.00, 581000000000.00, 581000000000.00, 506000000000.00, 501000000000.00, 535000000000.00, 582000000000.00]
                    getChart()
                    break;
                case "美国":
                    arrCounrtyData = [1150000000000.00, 1290000000000.00, 1060000000000.00, 1280000000000.00, 1480000000000.00, 1550000000000.00, 1580000000000.00, 1620000000000.00, 1500000000000.00, 1450000000000.00, 1550000000000.00, 1660000000000.00]
                    getChart()
                    break;
            }
        }

        function getChart() {
            // 构造表格
            var tabledata = []
            arrCounrtyData.forEach(element => {
                tabledata.push((Number(element) / 10000000000).toFixed(2));
            });
            var tableValue = document.getElementsByClassName('table-value')
            console.log(tableValue)
            for (var i = 0, len = tabledata.length; i < len; i++) {
                tableValue[i].innerHTML = tabledata[i]
            }

            // 为了柱状图显示不重叠，去掉小数点后位数
            arrCounrtyData.forEach(element => {
                oneOfLineToFixed0.push((Number(element) / 10000000000).toFixed(0));
            });
            console.log('第二次加载，将第一次加载柱状图中的元素清空')
            console.log(oneOfLineToFixed0)
            var dataChart = echarts.init(document.getElementById("data-chart"));
            let option = {
                title: {
                    text: "",
                    textStyle: {
                        color: "#fff",
                        padding: "3em"
                    }
                },
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    data: [{
                        name: " ",
                        icon: "circle",
                        textStyle: {
                            color: "#fff" // 图例文字颜色
                        }
                    }]
                },
                xAxis: {
                    type: "category",
                    name: "年",
                    boundaryGap: false,
                    data: [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018],
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                                // width:8,//这里是为了突出显示加上的
                        }
                    },
                    axisLabel: {
                        interval: 0, //横轴信息全部显示
                        rotate: -45, //度角倾斜显示
                        // formatter: function(value) {
                        //     //只显示五个字 其余省略号
                        //     return value.length > 5 ? value.substring(0, 5) + "..." : value;
                        // }
                    }
                },
                yAxis: {
                    show: true,
                    type: "value",
                    // name: "公里",
                    name: "美元",
                    axisLabel: {
                        formatter: "{value}十亿"
                    },
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                                // width:8,//这里是为了突出显示加上的
                        }
                    }
                },
                grid: {
                    left: "1%",
                    top: 40,
                    bottom: 10,
                    right: "8%",
                    // height:60,
                    containLabel: true
                },
                series: [{
                    name: country,
                    type: "bar",
                    stack: "总量",
                    // 显示数值
                    itemStyle: {
                        normal: {
                            label: {
                                show: true
                            }
                        }
                    },
                    barWidth: '15',
                    data: oneOfLineToFixed0,
                    color: "orange"
                        // leaves: {
                        //     label: {
                        //       normal: {
                        //         rotate: -65,
                        //       }
                        //     }
                        //   },
                }]
            };
            dataChart.setOption(option);
            oneOfLineToFixed0 = []

        }

        // function getRequest() {
        //     let url = window.location.search; //获取url中"?"符后的字串
        //     if (url.indexOf("=") != -1 && url.indexOf("&") != -1) {
        //         let leftIndex = url.indexOf("=") + 1;
        //         let rightIndex = url.indexOf("&");
        //         let str = url.slice(leftIndex, rightIndex); //提取=后&前的内容
        //         this.optionChange(decodeURI(str));
        //     } else {
        //         // let leftIndex = ;
        //         let str = url.slice(url.indexOf("=") + 1); //提取=后的内容，比如主键
        //         this.optionChange(decodeURI(str));
        //     }
        // }
    </script>
</body>

</html>